name: Test Windows Runner

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

on:
  push:
    branches:
      - main
jobs:
  job1:
    runs-on: windows-2019
    name: Build MOF
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Install & Update PS Modules
        run: |
          Install-Module -Name PowerShellGet -Force
          Install-Module 'PSDscResources' -Verbose -Force
          Install-Module Microsoft365DSC -Force
          Update-M365DSCDependencies
      - name: Get Creds & Run Build
        run: |
          $username = "${{secrets.CLIENT_ID}}"
          $password = ConvertTo-SecureString "${{secrets.CLIENT_SECRET}}" -AsPlainText -Force
          $Credential = New-Object System.Management.Automation.PSCredential -ArgumentList ($username, $password)
        run: .\build.ps1 -RunAsAdmin
